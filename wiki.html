
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikipedia Quiz Generator</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap)" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-button.active { border-color: #4f46e5; color: #4f46e5; font-weight: 600; }
        .details-modal-overlay { background-color: rgba(0, 0, 0, 0.7); }
        .quiz-card { border-left: 4px solid #4f46e5; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-4 sm:p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">ðŸ§  WikiQuiz Generator</h1>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-6">
            <button id="tab-generate" class="tab-button px-4 py-2 text-lg text-gray-600 border-b-2 border-transparent active" onclick="showTab('generate')">
                Generate Quiz
            </button>
            <button id="tab-history" class="tab-button px-4 py-2 text-lg text-gray-600 border-b-2 border-transparent" onclick="showTab('history')">
                Past Quizzes (History)
            </button>
        </div>

        <!-- TAB 1: GENERATE QUIZ -->
        <div id="tab-content-generate" class="tab-content">
            <div class="mb-6 space-y-4">
                <label for="wiki-url" class="block text-sm font-medium text-gray-700">Wikipedia Article URL</label>
                <div class="flex space-x-3">
                    <input type="url" id="wiki-url" placeholder="e.g., [https://en.wikipedia.org/wiki/Alan_Turing](https://en.wikipedia.org/wiki/Alan_Turing)" 
                           class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm"
                           value="[https://en.wikipedia.org/wiki/Alan_Turing](https://en.wikipedia.org/wiki/Alan_Turing)">
                    <button id="generate-btn" onclick="handleGenerateQuiz()"
                            class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 disabled:opacity-50">
                        Generate Quiz
                    </button>
                </div>
                <div id="status-message" class="text-sm text-center text-red-500 h-4"></div>
            </div>

            <!-- Quiz Output Display -->
            <div id="quiz-output" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-800">Generated Quiz: <span id="quiz-title" class="text-indigo-600"></span></h2>
                    <button id="take-quiz-btn" onclick="toggleTakeQuizMode()"
                            class="px-4 py-2 text-sm bg-purple-100 text-purple-700 font-medium rounded-lg hover:bg-purple-200 transition duration-150">
                        Take Quiz Mode
                    </button>
                </div>
                
                <div class="mb-6 p-4 bg-indigo-50 rounded-lg text-sm text-gray-700">
                    <span class="font-bold">Summary:</span> <span id="quiz-summary"></span>
                </div>

                <div id="quiz-questions-list" class="space-y-6 mb-8">
                    <!-- Quiz cards will be injected here -->
                </div>

                <!-- Metadata Cards -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="p-4 border rounded-lg bg-gray-50">
                        <h3 class="font-semibold text-gray-700 mb-2 flex items-center">
                            Key Entities
                            <svg class="w-4 h-4 ml-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-5m0 0l-5-5M17 14V8m0 0L5 20"></path></svg>
                        </h3>
                        <div id="key-entities-list" class="text-sm space-y-1">
                            <!-- Entities injected here -->
                        </div>
                    </div>
                    <div class="p-4 border rounded-lg bg-gray-50">
                        <h3 class="font-semibold text-gray-700 mb-2 flex items-center">
                            Related Topics
                            <svg class="w-4 h-4 ml-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.75a.75.75 0 01.75.75v7.5a.75.75 0 01-1.5 0v-7.5a.75.75 0 01.75-.75zM12 18.75a.75.75 0 01-.75.75h-.75v.75a.75.75 0 011.5 0v-.75h.75a.75.75 0 01-.75-.75z"></path></svg>
                        </h3>
                        <ul id="related-topics-list" class="list-disc pl-5 text-sm space-y-1">
                            <!-- Topics injected here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: PAST QUIZZES (HISTORY) -->
        <div id="tab-content-history" class="tab-content hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Quiz Generation History</h2>
            <div class="overflow-x-auto bg-white border border-gray-200 rounded-lg">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">URL</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th scope="col" class="px-6 py-3"></th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- History items will be injected here -->
                    </tbody>
                </table>
            </div>
            <div id="history-empty" class="text-center p-8 text-gray-500 hidden">
                No quizzes have been generated yet.
            </div>
        </div>

    </div>

    <!-- Details Modal (Hidden by default) -->
    <div id="details-modal" class="details-modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start border-b pb-3 mb-4">
                    <h2 class="text-2xl font-bold text-gray-800" id="modal-quiz-title">Quiz Details</h2>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition duration-150">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                
                <div id="modal-quiz-content">
                    <!-- The full quiz and metadata from the History item will be rendered here (reusing the card layout logic) -->
                </div>

                <div class="mt-6 text-right">
                    <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition duration-150">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data structure to simulate API responses and database storage (using localStorage)
        const MOCK_DB_KEY = 'wikiQuizHistory';
        let isTakeQuizMode = false;
        let currentQuizData = null;

        const MOCK_QUIZ_DATA = {
            id: 1,
            url: "[https://en.wikipedia.org/wiki/Alan_Turing](https://en.wikipedia.org/wiki/Alan_Turing)",
            title: "Alan Turing",
            summary: "Alan Mathison Turing OBE FRS (23 June 1912 â€“ 7 June 1954) was an English mathematician, computer scientist, logician, cryptanalyst, philosopher, and theoretical biologist. He was highly influential in the development of theoretical computer science, providing a formalisation of the concepts of algorithm and computation with the Turing machine. Turing is widely considered to be the father of theoretical computer science and artificial intelligence.",
            created_at: new Date().toISOString(),
            key_entities: {
                people: ["Alan Turing", "Alonzo Church", "David Hilbert"],
                organizations: ["University of Cambridge", "Bletchley Park"],
                locations: ["United Kingdom", "Manchester"]
            },
            sections: ["Early life", "World War II", "Legacy"],
            quiz: [
                {
                    question: "What concept did Alan Turing formalise that laid the foundation for computer science?",
                    options: ["The Von Neumann Architecture", "The Turing Machine", "The Lambda Calculus", "Quantum Entanglement"],
                    answer: "The Turing Machine",
                    difficulty: "easy",
                    explanation: "Turing is known for providing a formalisation of the concepts of algorithm and computation with the Turing machine."
                },
                {
                    question: "During World War II, at which location did Turing work on breaking German ciphers?",
                    options: ["MI6 Headquarters", "Bletchley Park", "The Pentagon", "Whitehall"],
                    answer: "Bletchley Park",
                    difficulty: "medium",
                    explanation: "He worked at Bletchley Park, the British codebreaking centre, where he played a pivotal role in cracking intercepted coded messages."
                },
                {
                    question: "What honorific was bestowed upon Alan Turing?",
                    options: ["Knight Grand Cross", "Order of the British Empire (OBE)", "Victoria Cross", "Fellow of the Royal Society (FRS)"],
                    answer: "Order of the British Empire (OBE)",
                    difficulty: "easy",
                    explanation: "His full title includes OBE FRS, showing he was appointed an Officer of the Order of the British Empire."
                },
                {
                    question: "The legal proceedings against Turing were related to charges of:",
                    options: ["Espionage", "Treason", "Gross indecency", "Perjury"],
                    answer: "Gross indecency",
                    difficulty: "hard",
                    explanation: "Turing was prosecuted in 1952 for gross indecency."
                },
                {
                    question: "Turing's work primarily contributed to the development of which field?",
                    options: ["Theoretical physics", "Pure mathematics", "Aeronautical engineering", "Theoretical computer science and AI"],
                    answer: "Theoretical computer science and AI",
                    difficulty: "easy",
                    explanation: "He is widely considered to be the father of theoretical computer science and artificial intelligence."
                }
            ],
            related_topics: ["Cryptography", "Enigma machine", "Theoretical computer science", "Artificial intelligence"]
        };


        // --- Core Application Logic ---

        function getHistory() {
            const history = localStorage.getItem(MOCK_DB_KEY);
            return history ? JSON.parse(history) : [];
        }

        function saveQuiz(quizData) {
            const history = getHistory();
            quizData.id = history.length + 1;
            history.unshift(quizData); // Add to the start
            localStorage.setItem(MOCK_DB_KEY, JSON.stringify(history));
            return quizData;
        }

        async function handleGenerateQuiz() {
            const urlInput = document.getElementById('wiki-url');
            const generateBtn = document.getElementById('generate-btn');
            const statusMessage = document.getElementById('status-message');

            const url = urlInput.value.trim();
            if (!url) {
                statusMessage.textContent = "Please enter a valid Wikipedia URL.";
                return;
            }

            // Simulate API Call and Loading State
            statusMessage.textContent = "Generating quiz (Scraping article and running LLM)... Please wait.";
            generateBtn.disabled = true;
            document.getElementById('quiz-output').classList.add('hidden');

            try {
                // *** MOCK API CALL START ***
                // In a real application, you would make a fetch() call to your FastAPI backend here.
                // const response = await fetch('[http://127.0.0.1:8000/generate_quiz](http://127.0.0.1:8000/generate_quiz)', { ... });
                // const quizData = await response.json();
                
                // For demonstration, use fixed mock data
                await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate network delay
                const quizData = MOCK_QUIZ_DATA;
                // *** MOCK API CALL END ***

                const storedData = saveQuiz(quizData); // Save to mock DB
                currentQuizData = storedData;
                
                renderQuiz(storedData, 'quiz-output', 'quiz-questions-list');
                
                statusMessage.textContent = "Quiz generated successfully!";
                document.getElementById('quiz-output').classList.remove('hidden');

            } catch (error) {
                statusMessage.textContent = `Error: Failed to generate quiz. Details: ${error.message}`;
            } finally {
                generateBtn.disabled = false;
            }
        }

        // --- UI Rendering Functions ---

        function getDifficultyColor(difficulty) {
            switch (difficulty.toLowerCase()) {
                case 'easy': return 'bg-green-100 text-green-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'hard': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function renderQuiz(data, outputContainerId, questionsListId) {
            const outputContainer = document.getElementById(outputContainerId);
            const questionsList = document.getElementById(questionsListId);
            questionsList.innerHTML = '';
            
            // Render Metadata
            if (outputContainerId === 'quiz-output') {
                document.getElementById('quiz-title').textContent = data.title;
                document.getElementById('quiz-summary').textContent = data.summary;
                
                const entitiesList = document.getElementById('key-entities-list');
                entitiesList.innerHTML = '';
                for (const type in data.key_entities) {
                    entitiesList.innerHTML += `<p class="font-medium capitalize text-indigo-700">${type}:</p><p class="text-gray-600">${data.key_entities[type].join(', ')}</p>`;
                }

                const topicsList = document.getElementById('related-topics-list');
                topicsList.innerHTML = data.related_topics.map(topic => `<li><a href="https://en.wikipedia.org/wiki/${topic.replace(/\s/g, '_')}" target="_blank" class="text-indigo-600 hover:text-indigo-800">${topic}</a></li>`).join('');

            }

            // Render Questions
            data.quiz.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'quiz-card p-4 rounded-lg shadow-md bg-white border border-gray-100';
                
                // Create a container for the question text and difficulty badge
                const header = document.createElement('div');
                header.className = 'flex justify-between items-start mb-3';
                
                const difficultyBadge = `<span class="px-2 py-0.5 text-xs font-semibold rounded-full ${getDifficultyColor(q.difficulty)}">${q.difficulty.toUpperCase()}</span>`;
                
                header.innerHTML = `<h4 class="font-bold text-gray-800 flex-1 mr-4">Q${index + 1}: ${q.question}</h4> ${difficultyBadge}`;
                
                questionElement.appendChild(header);

                // Options list
                const optionsList = document.createElement('ul');
                optionsList.className = 'space-y-2 mb-3 text-sm';
                q.options.forEach(option => {
                    const listItem = document.createElement('li');
                    listItem.textContent = option;
                    listItem.className = 'p-2 rounded-md transition-colors duration-150 cursor-pointer option-item';
                    
                    if (isTakeQuizMode) {
                        listItem.setAttribute('data-answer', option);
                        listItem.onclick = (e) => handleOptionClick(e.target, q.answer);
                    } else {
                        // Display answer in default mode
                        if (option === q.answer) {
                            listItem.classList.add('bg-green-100', 'font-semibold', 'text-green-800');
                        } else {
                            listItem.classList.add('hover:bg-gray-50', 'text-gray-700');
                        }
                    }
                    optionsList.appendChild(listItem);
                });
                questionElement.appendChild(optionsList);

                // Explanation (hidden in Take Quiz mode)
                const explanationDiv = document.createElement('div');
                explanationDiv.className = `explanation-box text-xs p-3 rounded-lg bg-gray-100 text-gray-700 transition-all duration-300 ${isTakeQuizMode ? 'hidden' : 'block'}`;
                explanationDiv.innerHTML = `<span class="font-semibold text-indigo-600">Explanation:</span> ${q.explanation}`;
                questionElement.appendChild(explanationDiv);
                
                questionsList.appendChild(questionElement);
            });
            
            if (outputContainerId === 'modal-quiz-content') {
                 // In the modal, we need to manually add the metadata since we reuse the rendering logic
                const metadataHTML = `
                    <div class="mb-4 text-sm">
                        <p class="text-gray-500 mb-2">Generated on: ${new Date(data.created_at).toLocaleString()}</p>
                        <p class="font-bold text-gray-700">Source URL:</p>
                        <a href="${data.url}" target="_blank" class="text-indigo-600 hover:text-indigo-800 truncate block">${data.url}</a>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-2">Key Entities</h3>
                    <div class="space-y-1 text-sm">${Object.entries(data.key_entities).map(([type, list]) => `<p><span class="font-medium capitalize text-indigo-700">${type}:</span> ${list.join(', ')}</p>`).join('')}</div>
                    <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-2">Related Topics</h3>
                    <ul class="list-disc pl-5 text-sm space-y-1">${data.related_topics.map(topic => `<li>${topic}</li>`).join('')}</ul>
                    <hr class="my-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Questions</h3>
                `;
                questionsList.insertAdjacentHTML('beforebegin', metadataHTML);
            }
        }

        function handleOptionClick(clickedElement, correctAnswer) {
            if (!isTakeQuizMode) return;

            const parentList = clickedElement.parentNode;
            const allOptions = parentList.querySelectorAll('.option-item');
            const explanationBox = parentList.parentNode.querySelector('.explanation-box');

            // Disable all options in this question after one click
            allOptions.forEach(opt => {
                opt.onclick = null; // Disable further clicks
                opt.classList.remove('bg-gray-50', 'hover:bg-gray-50');
            });

            // Reveal correct/incorrect status and explanation
            const selectedAnswer = clickedElement.getAttribute('data-answer');
            explanationBox.classList.remove('hidden');

            if (selectedAnswer === correctAnswer) {
                clickedElement.classList.add('bg-green-200', 'font-semibold', 'text-green-900');
            } else {
                clickedElement.classList.add('bg-red-200', 'font-semibold', 'text-red-900');
                // Highlight the correct answer
                allOptions.forEach(opt => {
                    if (opt.getAttribute('data-answer') === correctAnswer) {
                        opt.classList.add('bg-green-100', 'border', 'border-green-600');
                    }
                });
            }
        }


        // --- UI Control Functions ---

        function toggleTakeQuizMode() {
            if (!currentQuizData) return;

            isTakeQuizMode = !isTakeQuizMode;
            const btn = document.getElementById('take-quiz-btn');
            
            if (isTakeQuizMode) {
                btn.textContent = 'View Answers';
                btn.classList.remove('bg-purple-100');
                btn.classList.add('bg-red-100', 'text-red-700');
            } else {
                btn.textContent = 'Take Quiz Mode';
                btn.classList.remove('bg-red-100', 'text-red-700');
                btn.classList.add('bg-purple-100', 'text-purple-700');
            }

            renderQuiz(currentQuizData, 'quiz-output', 'quiz-questions-list');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));

            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.getElementById(`tab-content-${tabName}`).classList.remove('hidden');

            if (tabName === 'history') {
                renderHistory();
            }
        }

        function renderHistory() {
            const history = getHistory();
            const tableBody = document.getElementById('history-table-body');
            const emptyMessage = document.getElementById('history-empty');
            tableBody.innerHTML = '';

            if (history.length === 0) {
                emptyMessage.classList.remove('hidden');
                return;
            }
            emptyMessage.classList.add('hidden');

            history.forEach(item => {
                const date = new Date(item.created_at).toLocaleDateString();
                const row = `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.title}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 truncate max-w-xs">${item.url}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="openModal(${item.id})" class="text-indigo-600 hover:text-indigo-900 px-3 py-1 bg-indigo-50 rounded-md">Details</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        function openModal(id) {
            const history = getHistory();
            const quizItem = history.find(item => item.id === id);
            
            if (!quizItem) {
                document.getElementById('modal-quiz-title').textContent = "Error: Quiz not found.";
                return;
            }

            // Render quiz details into the modal
            document.getElementById('modal-quiz-title').textContent = quizItem.title;
            renderQuiz(quizItem, 'details-modal', 'modal-quiz-content');

            // Show modal
            document.getElementById('details-modal').classList.remove('hidden');
        }

        function closeModal() {
            // Clear content and hide modal
            document.getElementById('details-modal').classList.add('hidden');
            document.getElementById('modal-quiz-content').innerHTML = '';
        }

        // Initialize mock data on load if empty, to show an example on first run
        window.onload = () => {
             // Mock generation on first load
             if (getHistory().length === 0) {
                 saveQuiz({...MOCK_QUIZ_DATA, id: 1});
             }
             // Load the last generated quiz into the current view
             const history = getHistory();
             if (history.length > 0) {
                 currentQuizData = history[0];
                 renderQuiz(currentQuizData, 'quiz-output', 'quiz-questions-list');
                 document.getElementById('quiz-output').classList.remove('hidden');
             }
        }
    </script>
</body>
</html>
